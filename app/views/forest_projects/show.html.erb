<div class="min-h-full">
  <main class="py-10">
    <!-- Page header -->
    <div class="mx-auto max-w-3xl px-4 sm:px-6 md:flex md:items-center md:justify-between md:space-x-5 lg:max-w-7xl lg:px-8">
      <div class="flex items-center space-x-5">
        <div>
          <h1 class="text-2xl font-bold text-gray-900"><%= @forest_project.client_name %></h1>
          <p class="text-sm font-medium text-gray-500"><%= @forest_project.project_name %></p>
        </div>

      </div>
      <div class="mt-6 flex space-x-3 md:mt-0 md:ml-4">
        <span><%= link_to 'Back', forest_projects_path %></span>
        <span>â€¢</span>
        <span><%= link_to 'Reprocess File', reprocess_forest_project_path(@forest_project), method: :post, class: 'btn btn-primary' %></span>

      </div>
    </div>

    <div class="mx-auto mt-8 grid max-w-3xl grid-cols-1 gap-6 sm:px-6 lg:max-w-7xl lg:grid-flow-col-dense lg:grid-cols-3">
      <div class="space-y-6 lg:col-span-8 lg:col-start-1">

        <!-- Project Details-->
        <section aria-labelledby="applicant-information-title">
          <div class="bg-white shadow sm:rounded-lg">
            <div class="px-4 py-5 sm:px-6">
              <h2 id="applicant-information-title" class="text-lg font-medium leading-6 text-gray-900">Project Details</h2>
            </div>
            <div class="border-t border-gray-200 px-4 py-5 sm:px-6">
              <dl class="grid grid-cols-2 gap-x-4 gap-y-8 sm:grid-cols-2">
                <div class="sm:col-span-1">
                  <dt class="text-sm font-medium text-gray-500">Created</dt>
                  <dd class="mt-1 text-sm text-gray-900"><%= @forest_project.created_at.strftime("%B %d, %Y %H:%M") %></dd>
                </div>
                <div class="sm:col-span-1">
                  <dt class="text-sm font-medium text-gray-500">Status</dt>
                  <dd class="mt-1 text-sm text-gray-900">
                    <div><%= @forest_project.status %></div>
                    <% if @forest_project.error_message.present? %>
                    <div id="error-message" class="mt-1 text-xs text-gray-900 font-mono bg-gray-100 p-3 rounded whitespace-pre-wrap max-h-14 overflow-hidden" style="transition: max-height 0.3s ease; max-height: 3.5rem;">
                      <%= simple_format @forest_project.error_message %>
                    </div>
                    <a id="show-link" href="#" class="text-xs text-blue-600" onclick="toggleErrorMessage(); return false;">(show)</a>
                    <script>
                        function toggleErrorMessage() {
                            const errorMessage = document.getElementById("error-message");
                            const showLink = document.getElementById("show-link");

                            if (errorMessage.style.maxHeight === "none") {
                                errorMessage.style.maxHeight = "3rem";
                                showLink.innerText = "(show)";
                            } else {
                                errorMessage.style.maxHeight = "none";
                                showLink.innerText = "(hide)";
                            }
                        }
                    </script>
                  <% end %>
                  </dd>
                </div>
                <div class="sm:col-span-1">
                  <dt class="text-sm font-medium text-gray-500">Files</dt>
                  <dd class="mt-1 text-sm text-gray-900">
                    <!-- link to download csv file -->
                    <% if @csv_url %>
                      <div class="mt-1 text-sm text-gray-900">
                        <%= link_to @csv_filename, @csv_url, class: 'text-blue-600' %>
                      </div>
                    <% end %>
                    <% if @google_sheet %>
                      <div class="mt-1 text-sm text-gray-900">
                        <%= link_to 'Google Sheet', @google_sheet, class: 'text-blue-600' %>
                      </div>
                    <% end %>
                    <% if @google_doc %>
                      <div class="mt-1 text-sm text-gray-900">
                        <%= link_to 'Google Doc', @google_doc, class: 'text-blue-600' %>
                      </div>
                    <% end %>

                  </dd>
                </div>
              </dl>
            </div>
          </div>
        </section>

        <!-- Results -->
        <section aria-labelledby="summary-data-title">
          <div class="bg-white shadow sm:rounded-lg">
            <div class="px-4 py-5 sm:px-6">
              <h2 id="summary-data-title" class="text-lg font-medium leading-6 text-gray-900">Results</h2>
            </div>
            <div class="border-t border-gray-200 px-4 py-5 sm:px-6">
              <dl class="grid grid-cols-2 gap-x-4 gap-y-8 sm:grid-cols-6">
                <% if @condition_summary %>
                <!-- Condition -->
                <div class="sm:col-span-1">
                  <dt class="text-sm font-bold text-gray-500">Condition</dt>
                  <dd class="mt-1 text-sm text-gray-900">
                    <dl class="-my-3 divide-y divide-gray-100 px-6 py-4 text-sm leading-6">
                      <div class="flex justify-between gap-x-4 py-0.5">
                        <dt class="text-gray-500 font-medium">Excellent</dt>
                        <dd class="text-gray-700"><%= @condition_summary['excellent'] %></dd>
                      </div>
                      <div class="flex justify-between gap-x-4 py-0.5">
                        <dt class="text-gray-500 font-medium">Good</dt>
                        <dd class="text-gray-700"><%= @condition_summary['good'] %></dd>
                      </div>
                      <div class="flex justify-between gap-x-4 py-0.5">
                        <dt class="text-gray-500 font-medium">Fair</dt>
                        <dd class="text-gray-700"><%= @condition_summary['fair'] %></dd>
                      </div>
                      <div class="flex justify-between gap-x-4 py-0.5">
                        <dt class="text-gray-500 font-medium">Poor</dt>
                        <dd class="text-gray-700"><%= @condition_summary['poor'] %></dd>
                      </div>
                      <div class="flex justify-between gap-x-4 py-0.5">
                        <dt class="text-gray-500 font-medium">Dead</dt>
                        <dd class="text-gray-700"><%= @condition_summary['dead'] %></dd>
                      </div>
                    </dl>
                  </dd>
                </div>
                  <% end %>
                <% if @dbh_summary %>
                <!-- DBH -->
                <div class="sm:col-span-1">
                  <dt class="text-sm font-bold text-gray-500">DBH</dt>
                  <dd class="mt-1 text-sm text-gray-900">
                    <dl class="-my-3 divide-y divide-gray-100 px-6 py-4 text-sm leading-6">
                      <div class="flex justify-between gap-x-4 py-0.5">
                        <dt class="text-gray-500 font-medium">Min</dt>
                        <dd class="text-gray-700"><%= @dbh_summary['min_dbh'] %></dd>
                      </div>
                      <div class="flex justify-between gap-x-4 py-0.5">
                        <dt class="text-gray-500 font-medium">Max</dt>
                        <dd class="text-gray-700"><%= @dbh_summary['max_dbh'] %></dd>
                      </div>
                    </dl>
                  </dd>
                </div>
                  <% end %>
                <% if @species_summary %>
                <!-- Species -->
                <div class="sm:col-span-2">
                  <dt class="text-sm font-bold text-gray-500">Species</dt>
                  <dd class="mt-1 text-sm text-gray-900">
                    <dl class="-my-3 divide-y divide-gray-100 px-6 py-4 text-sm leading-6">
                      <% @species_summary.each do |species| %>
                        <div class="flex justify-between gap-x-4 py-0.5">
                          <dt>
                            <span class="text-gray-500 font-medium"><%= species[1]['latin'] %></span>
                            <span class="text-gray-300 font-thin"><%= species[1]['common'] %></span>
                          </dt>
                          <dd class="text-gray-700"><%= species[1]['count'] %></dd>
                        </div>
                      <% end %>
                    </dl>
                  </dd>
                </div>
                  <% end %>
              </dl>
            </div>
          </div>
        </section>

        <% if @csv_data %>
        <!-- Raw Data-->
        <section aria-labelledby="notes-title">
          <div class="bg-white shadow sm:overflow-hidden sm:rounded-lg">
            <div class="divide-y divide-gray-200">
              <div class="px-4 py-5 sm:px-6">
                <h2 id="notes-title" class="text-lg font-medium text-gray-900">Data</h2>
              </div>
              <div class="px-4 py-6 sm:px-6">
                <div style="width:100%; height: 400px; overflow-x: auto;" class=" border border-gray-300">
                  <div class="px-4 sm:px-6 lg:px-8">
                    <div class="flow-root">
                      <div class="-mx-4 -my-2 sm:-mx-6 lg:-mx-8">
                        <div class="inline-block min-w-full py-2 align-middle">
                          <table class="min-w-full divide-y divide-gray-300">
                            <thead class="sticky bg-indigo-50 sticky top-0 z-10 border-b-1 border-gray-300">
                            <tr class="">
                              <th scope="col" class="text-center bg-slate-100 py-1 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">pid</th>
                              <th scope="col" class="text-center bg-slate-100 py-1 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">common_name</th>
                              <th scope="col" class="text-center bg-slate-100 py-1 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">scientific_name</th>
                              <th scope="col" class="text-center bg-slate-100 py-1 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">condition</th>
                              <th scope="col" class="text-center bg-slate-100 py-1 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">tree_workpruning</th>
                              <th scope="col" class="text-center bg-slate-100 py-1 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">tree_workother</th>
                              <th scope="col" class="text-center bg-slate-100 py-1 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">tree_tag</th>
                              <th scope="col" class="text-center bg-slate-100 py-1 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">dbh</th>
                              <th scope="col" class="text-center bg-slate-100 py-1 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">within_years</th>
                              <th scope="col" class="text-center bg-slate-100 py-1 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">cycle</th>
                              <th scope="col" class="text-center bg-slate-100 py-1 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">tree_height_estimated</th>
                              <th scope="col" class="text-center bg-slate-100 py-1 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">crown_spread</th>
                              <th scope="col" class="text-center bg-slate-100 py-1 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">notesmgmt</th>
                              <th scope="col" class="text-center bg-slate-100 py-1 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">observation_comments</th>
                              <th scope="col" class="text-center bg-slate-100 py-1 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">observationscharacteristics</th>
                              <th scope="col" class="text-center bg-slate-100 py-1 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">special_equipment</th>
                            </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200 bg-white">
                            <% @csv_data.each do |row| %>
                              <tr class="divide-x divide-gray-200 hover:bg-indigo-50">
                                <td class="whitespace-nowrap px-3 py-2 text-sm text-gray-500 hover:bg-indigo-100"><%= row[:pid] %></td>
                                <td class="whitespace-nowrap px-3 py-2 text-sm text-gray-500 hover:bg-indigo-100"><%= row[:common_name] %></td>
                                <td class="whitespace-nowrap px-3 py-2 text-sm text-gray-500 hover:bg-indigo-100"><%= row[:scientific_name] %></td>
                                <td class="whitespace-nowrap px-3 py-2 text-sm">
                                  <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium
  <%= "bg-red-500 text-white" if row[:condition] == 'Dead' %>
  <%= "bg-yellow-500 text-white" if row[:condition] == 'Poor' %>
  <%= "bg-blue-500 text-white" if row[:condition] == 'Fair' %>
  <%= "bg-green-500 text-white" if row[:condition] == 'Good' %>
  <%= "bg-indigo-500 text-white" if row[:condition] == 'Excellent' %>
">
  <%= row[:condition] %>
</span>

                                </td>
                                <td class="whitespace-nowrap px-3 py-2 text-sm text-gray-500 hover:bg-indigo-100"><%= row[:tree_workpruning] %></td>
                                <td class="whitespace-nowrap px-3 py-2 text-sm text-gray-500 hover:bg-indigo-100"><%= row[:tree_workother] %></td>
                                <td class="whitespace-nowrap px-3 py-2 text-sm text-gray-500 hover:bg-indigo-100"><%= row[:tree_tag] %></td>
                                <td class="whitespace-nowrap px-3 py-2 text-sm text-gray-500 hover:bg-indigo-100"><%= row[:dbh] %></td>
                                <td class="whitespace-nowrap px-3 py-2 text-sm text-gray-500 hover:bg-indigo-100"><%= row[:within_years] %></td>
                                <td class="whitespace-nowrap px-3 py-2 text-sm text-gray-500 hover:bg-indigo-100"><%= row[:cycle] %></td>
                                <td class="whitespace-nowrap px-3 py-2 text-sm text-gray-500 hover:bg-indigo-100"><%= row[:tree_height_estimated] %></td>
                                <td class="whitespace-nowrap px-3 py-2 text-sm text-gray-500 hover:bg-indigo-100"><%= row[:crown_spread] %></td>
                                <td class="whitespace-nowrap px-3 py-2 text-sm text-gray-500 hover:bg-indigo-100"><%= row[:notesmgmt] %></td>
                                <td class="whitespace-nowrap px-3 py-2 text-sm text-gray-500 hover:bg-indigo-100"><%= row[:observation_comments] %></td>
                                <td class="whitespace-nowrap px-3 py-2 text-sm text-gray-500 hover:bg-indigo-100"><%= row[:observationscharacteristics] %></td>
                                <td class="whitespace-nowrap px-3 py-2 text-sm text-gray-500 hover:bg-indigo-100"><%= row[:special_equipment] %></td>
                              </tr>
                            <% end %>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
          <% end %>
      </div>
    </div>
  </main>
</div>

